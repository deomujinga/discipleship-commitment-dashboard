<script>
  // ... keep everything above this as-is

  (async function main(){
    // ... keep all existing code up to where the heatmap is rendered

    const hdr = document.getElementById("wkHeader");
    WEEKDAYS.forEach(ch => {
      const s = document.createElement("span");
      s.textContent = ch;
      hdr.appendChild(s);
    });

    const heat = document.getElementById("heat");
    const datesSorted = Object.keys(dayMap).sort();
    const last42 = datesSorted.slice(-42);
    while (last42.length < 42) last42.unshift(null);

    // === Heatmap with hover titles ===
    for (let r = 0; r < 6; r++) {
      const row = document.createElement("div");
      row.className = "row";

      for (let c = 0; c < 7; c++) {
        const idx = r * 7 + c;
        const d = last42[idx];

        const cell = document.createElement("div");
        cell.className = "cell";

        // Figure out completion flags for tooltip
        const doneR = d && dayMap[d] ? Number(dayMap[d]["Bible Reading"]) >= 1 : false;
        const doneI = d && dayMap[d] ? Number(dayMap[d]["Morning Intimacy"]) >= 1 : false;
        const doneM = d && dayMap[d] ? Number(dayMap[d]["Scripture Memorization"]) >= 1 : false;

        // Add the three stacked segments (R/I/M)
        ["Bible Reading", "Morning Intimacy", "Scripture Memorization"].forEach(k => {
          const seg = document.createElement("div");
          seg.className =
            "seg " +
            (k === "Bible Reading" ? "read" : k === "Morning Intimacy" ? "intimacy" : "memory");
          if (d && dayMap[d] && Number(dayMap[d][k]) >= 1) seg.classList.add("on");
          cell.appendChild(seg);
        });

        // Native browser tooltip: date + checks
        if (d) {
          cell.title =
            `${d}\n` +
            `Reading: ${doneR ? "✓" : "—"}  •  ` +
            `Intimacy: ${doneI ? "✓" : "—"}  •  ` +
            `Memorization: ${doneM ? "✓" : "—"}`;
        } else {
          cell.style.opacity = 0.35;
          cell.title = "No data";
        }

        row.appendChild(cell);
      }
      heat.appendChild(row);
    }
  })();
</script>
